---
title: "Correlation with Birthwt Data"
author: "Ismail Ibican"
date: "today" 
lang: en
abstract: |
  This document summarizes the initial steps of my journey in learning the R 
  programming language and my exploration of fundamental concepts in Data Science. 
  It focuses on the process of cleaning, analyzing, and transforming datasets 
  into meaningful insights by leveraging R's powerful statistical and 
  visualization capabilities. Specific emphasis is placed on using the Tidyverse 
  ecosystem for data manipulation (dplyr) and effective data visualization 
  (ggplot2) techniques. This report aims to serve not only as a testament to my 
  learning process but also to form the foundation for my future comprehensive 
  data science projects.
format: 
  html: 
    theme: cosmo 
    toc: true
    toc-depth: 3 
    number-sections: true 
    title-block-style: none 
---

```{r}
library(MASS)
str(birthwt)
```

```{r}
library(knitr)
kable(head(birthwt), caption = "Ä°lk 6 gÃ¶zlem", align = "c")
```

```{r}
paste(colnames(birthwt), collapse = ", ")
```

> As we can see that we checked the column names of dataFrame "birthwt"
>
> And also column names are very common.

```{r}
colnames(birthwt) <- c("birthwt.below.2500", "mother.age", "mother.weight", 
    "race", "mother.smokes", "previous.prem.labor", "hypertension", "uterine.irr", 
    "physician.visits", "birthwt.grams")

```

> Renaming Factors :

-   All the factors are currently represented as integers

-   Let's use transform() and mapvalues() functions to convert variables to factors and give the factors more meaningful levels

> What does transform and mapvalues function do ?
>
> Transform() -\> It helps us to create new columns and also manipulate the columns that are already we had
>
> Mapvalues() -\> It assings vector values to each other (Vector \<- Vector)
>
> And also we must call library(plyr) before executing transform and mapvalues

```{r}
library(plyr)
birthwt <- transform(birthwt, 
            race = as.factor(mapvalues(race, c(1, 2, 3), 
                              c("white","black", "other"))),
            mother.smokes = as.factor(mapvalues(mother.smokes, 
                              c(0,1), c("no", "yes"))),
            hypertension = as.factor(mapvalues(hypertension, 
                              c(0,1), c("no", "yes"))),
            uterine.irr = as.factor(mapvalues(uterine.irr, 
                              c(0,1), c("no", "yes"))),
            birthwt.below.2500 = as.factor(mapvalues(birthwt.below.2500,
                              c(0,1), c("no", "yes")))
            )
```

> Now, It's time to summary our dataFrame :

```{r}
summary(birthwt)
```

> And also we can summarize our summary as well like this way :

```{r}
mean(birthwt$birthwt.grams)
```

```{r}
mean(birthwt$birthwt.grams[birthwt$mother.smokes=="yes"])
```

```{r}
mean(birthwt$birthwt.grams[birthwt$mother.smokes=="no"])
```

```{r}
sd(birthwt$birthwt.grams)
```

```{r}
sd(birthwt$birthwt.grams[birthwt$mother.smokes=="yes"])
```

```{r}
sd(birthwt$birthwt.grams[birthwt$mother.smokes=="no"])
```

> Here is a function that helps us to get summary of five numbers :

```{r}
fivenum(birthwt$birthwt.grams)
```

> Here the how can we calculate the outputs :

-   1- Minimum \| Minimum observation

-   2- First quartile \| 25% quartile piece

-   3- Median \| Mid of the data's

-   4 - 3. quartile \| 75% quartile piece

-   5 - Maximum \| Last quartile (last outlier)

```{r}
fivenum(birthwt$birthwt.grams[birthwt$mother.smokes=="yes"])
```

```{r}
fivenum(birthwt$birthwt.grams[birthwt$mother.smokes=="no"])
```

> A simple table - Letâ€™s use theÂ `tapply()`Â function to see what the average birthweight looks like when broken down by race and smoking status
>
> `tapply()` in R allows you to **split a vector into groups** and then **apply a summary function** (such as mean, sum, or median) to each group.

```{r}
with(birthwt, tapply(birthwt.grams, INDEX = list(race, mother.smokes), FUN = mean)) 
```

> We split our vectors to their means and here is the steps to split them :
>
> Now our code block says that from dataFrame birthwt, observe birthwt.grams and look this criteria race and mother.smokes then take each of it's mean

```{r}
with(birthwt, tapply(birthwt.grams, INDEX = list(race, mother.smokes), FUN = sd)) 
```

```{r}
with(birthwt, tapply(birthwt.grams, INDEX = list(race, mother.smokes), FUN = median)) 
```

```{r}
with(birthwt, tapply(birthwt.grams, INDEX = list(race, mother.smokes), FUN = IQR)) 
```

> IQR -\> 3RD QUARTILE - 1ST QUARTILE

> What if we wanted nicer looking output? - Letâ€™s use the headerÂ `{r, results='asis'}`, along with theÂ `kable()`Â function from theÂ `knitr`Â library (This part is important to get better look outputs

```{r}
library(knitr)
bwt.tbl <- with(birthwt, tapply(birthwt.grams, INDEX = list(race, mother.smokes), FUN = mean))
kable(bwt.tbl, format = "markdown")
```

-   `kable()` outputs the table in a way that Markdown can read and nicely display

-   Note: changing the CSS changes the table appearance

> aggregate() function - Letâ€™s first recall whatÂ `tapply()`Â does

-   Command:Â `tapply(X, INDEX, FUN)`

<!-- -->

-   Applies `FUN` to `X` grouped by factors in `INDEX`

<!-- -->

-   **`aggregate()`** performs a similar operation, but presents the results in a form that is at times more convenient

-   There are many ways to call the `aggregate()` function

-   Analog of `tapply` call: `aggregate(X, by, FUN)`

    -   Here, `by` is exactly like `INDEX`

> Example: tapply vs aggregate
>
> Here is an example with tapply before aggregate function :

```{r}
library(MASS)
with(birthwt, tapply(birthwt.grams, INDEX = list(race, mother.smokes), FUN = mean)) # tapply
```

```{r}
with(birthwt, aggregate(birthwt.grams, by = list(race, mother.smokes), FUN = mean)) # aggregate
```

> Operating this method with aggregate it makes more readable for others

```{r}
with(birthwt, aggregate(birthwt.grams, by = list(race, hypertension), FUN = mean)) # aggregate
```

> Here is a way to call aggregate with different syntax

```{r}
aggregate(birthwt.grams ~ race + mother.smokes, FUN=mean, data=birthwt)
```

> One of it response variable the other one is explanatory variable

```{r}
weight.smoke.tbl <- with(birthwt, table(birthwt.below.2500, mother.smokes))
weight.smoke.tbl
```

```{r}
or.smoke.bwt <- (weight.smoke.tbl[2,2] / weight.smoke.tbl[1,2]) / (weight.smoke.tbl[2,1] / weight.smoke.tbl[1,1])
or.smoke.bwt
```

> -   So the odds of low birth weight are 2 times higher when the mother smokes

# ðŸ’¡Correlation :

> -   Is the motherâ€™s age correlated with birth weight?

```{r}
par(mfrow = c(2,2))
plot(birthwt$birthwt.grams)
plot(birthwt$birthwt.grams,birthwt$mother.age)
plot(birthwt$birthwt.grams,birthwt$mother.weight)
cor(birthwt$birthwt.grams,birthwt$mother.weight)
```

> Here we defined some plots to view and analize our dataFrames

```{r}
cor(birthwt$birthwt.grams,birthwt$mother.age)  # Calculate correlation
```

```{r}
with(birthwt, cor(birthwt.grams, mother.age)) 

```

> -   Does this change when we account for smoking status?

```{r}
par(mfrow = c(2,1))
plot(birthwt$birthwt.grams[birthwt$mother.smokes == "yes"], birthwt$mother.age[birthwt$mother.smokes == "yes"])
with(birthwt, plot(birthwt.grams[mother.smokes == "yes"], mother.age[mother.smokes == "yes"]))
```

> If we include smoking factor to birthweigth it effects

```{r}
with(birthwt, cor(birthwt.grams[mother.smokes == "yes"], mother.age[mother.smokes == "yes"]))
```

```{r}
with(birthwt, plot(birthwt.grams[mother.smokes == "no"], mother.age[mother.smokes == "no"]))
```

```{r}
with(birthwt, cor(birthwt.grams[mother.smokes == "no"], mother.age[mother.smokes == "no"]))
```

> Faster way: by() function - Think of theÂ `by(data, INDICES, FUN)`Â function as aÂ `tapply()`Â function that operates on data frames instead of just vectors

-   When using `tapply(X, INDEX, FUN)`, `X` is generally a numeric vector

-   To calculate correlations, we need to allow `X` to be a data frame or matrix

```{r}
by(data = birthwt, 
   INDICES = birthwt[,"mother.smokes"], 
   FUN = summary)
```

> We get the summary of birthwt\[mother.smokes\]

```{r}
by(data = birthwt$mother.weight, 
   INDICES = birthwt["mother.smokes"], 
   FUN = mean)
```

# **ðŸ’¡**Single-Variables Plots :

> Letâ€™s continue with the `birthwt` data from the `MASS` library.
>
> Here are some basic single-variable plots.

```{r}
par(mfrow = c(2,4)) # Display plots in a single 2 x 2 figure 
plot(birthwt$mother.age)
with(birthwt, hist(mother.age))
with(birthwt, boxplot(mother.age))
plot(birthwt$mother.smokes)
plot(birthwt$birthwt.grams)
plot(birthwt$birthwt.grams,birthwt$mother.weight,
     xlab = "DoÄŸum AÄŸÄ±rlÄ±ÄŸÄ±",
     ylab = "Anne AÄŸÄ±rlÄ±ÄŸÄ±")
qqnorm(birthwt$birthwt.grams)
qqline(birthwt$birthwt.grams)
qqnorm(birthwt$mother.weight)
qqline(birthwt$mother.weight)
```

> At the first plot as we can see we are comparing index and mother.age because we did not specified other axis so that we will see that index and mother.age

> Note that the result of calling `plot(x, ...)` varies depending on what `x` is.\
> - When `x` is *numeric*, you get a plot showing the value of `x` at every index.\
> - When `x` is a *factor*, you get a bar plot of counts for every level
>
> Letâ€™s add more information to the smoking bar plot, and also change the color by setting the `col` option

```{r}
par(mfrow = c(1,1))
plot(birthwt$mother.smokes, 
     main = "Mothers Who Smoked In Pregnancy", 
     xlab = "Smoking during pregnancy", 
     ylab = "Count of Mothers",
     col = "lightgrey")
```

```{r}
boxplot(birthwt$birthwt.grams~birthwt$hypertension)

```

```{r}
boxplot(birthwt$birthwt.grams~birthwt$mother.smokes)
```

```{r}
boxplot(birthwt$birthwt.grams~birthwt$physician.visits)
```

> As we can see that it is not disturbed normally if we want to analiyse our data we should use scatterplot

```{r}
plot(birthwt$physician.visits, 
     birthwt$birthwt.grams,
     xlab = "Doktor Ziyareti SayÄ±sÄ±",
     ylab = "DoÄŸum AÄŸÄ±rlÄ±ÄŸÄ± (gram)",
     main = "DoÄŸum AÄŸÄ±rlÄ±ÄŸÄ± vs Doktor Ziyareti SayÄ±sÄ±",
     pch = 19,       # NoktalarÄ± doldur
     col = "darkgreen"
)

```

> ### **ðŸ’¡(much) better graphics with ggplot2**
>
> #### **Introduction to ggplot2**
>
> ggplot2 has a slightly steeper learning curve than the base graphics functions, but it also generally produces far better and more easily customizable graphics.
>
> There are two basic calls in ggplot:
>
> -   `qplot(x, y, ..., data)`: a â€œquick-plotâ€ routine, which essentially replaces the base `plot()`
>
> -   `ggplot(data, aes(x, y, ...), ...)`: defines a graphics object from which plots can be generated, along with *aesthetic mappings* that specify how variables are mapped to visual properties.

```{r}
library(ggplot2)
```

#### **plot vs qplot**

Hereâ€™s how the default scatterplots look in ggplot compared to the base graphics. Weâ€™ll illustrate things by continuing to use the birthwt data from the `MASS` library.

```{r}
with(birthwt, plot(mother.age, birthwt.grams))  # Base graphics 
```

```{r}
qplot(x=mother.age, y=birthwt.grams, data=birthwt)  # using qplot from ggplot2
```

> Remember how it took us some effort last time to add color coding, use different plotting characters, and add a legend? Hereâ€™s theÂ `qplot`Â call that does it all in one simple line.

```{r}
qplot(x=mother.age, y=birthwt.grams, data=birthwt,
      color = mother.smokes,
      shape = mother.smokes,
      xlab = "Mother's age (years)",
      ylab = "Baby's birthweight (grams)"
      ) 

```

This way you wonâ€™t run into problems of accidentally producing the wrong legend. The legend is produced based on the `colour` and `shape` argument that you pass in. (Note: `color` and `colour` have the same effect. )

#### **ggplot function**

```{r}
ggplot(data=birthwt, aes(x=birthwt.grams, y=mother.age))
```

```{r}
birthwt.plot <- ggplot(data=birthwt, aes(x=birthwt.grams, y=mother.age))
birthwt.plot + geom_point()
```

> geom_point() -\> That adds points on the ggplot2 axis

> Letâ€™s take a step back and try to understand the ggplot syntax.
>
> 1.  The first thing we did was to define a graphics object, `birthwt.plot`. This definition told R that weâ€™re using the `birthwt` data, and that we want to display `carat` on the x-axis, and `price` on the y-axis.
>
> 2.  We then called `birthwt.plot + geom_point()` to get a scatterplot.
>
> The arguments passed to `aes()` are called **mappings**. Mappings specify what variables are used for what purpose. When you use `geom_point()` in the second line, it pulls `x`, `y`, `colour`, `size`, etc., from the **mappings** specified in the `ggplot()` command.
>
> You can also specify some arguments to `geom_point` directly if you want to specify them for each plot separately instead of pre-specifying a default.
>
> Here we shrink the points to a smaller size, and use the `alpha` argument to make the points transparent.

```{r}
birthwt.plot + geom_point(size = 0.7, alpha = 0.3)
```

------------------------------------------------------------------------

> alpha -\> that makes points transperent.

> If we wanted to let point color depend on the color indicator of the diamond, we could do so in the following way.

------------------------------------------------------------------------

```{r}
birthwt.plot <- ggplot(data=birthwt, aes(x=birthwt.grams, y=mother.age, colour = mother.smokes))
birthwt.plot + geom_point()
```

> We can change colors by specifying a different color palette. Hereâ€™s how we can switch to theÂ `cbPalette`Â we saw last class.

------------------------------------------------------------------------

```{r}
cPalette <- c("#999999", "navyblue")
birthwt.plot <- ggplot(data=birthwt, aes(x=birthwt.grams, y=mother.age, colour = mother.smokes))
birthwt.plot + geom_point() + scale_colour_manual(values=cPalette)
```

> To make the scatterplot look more typical, we can sometimes switch to logarithmic coordinate axis spacing.

------------------------------------------------------------------------

```{r}
birthwt.plot + geom_point() +
  coord_transform(x = "log10", y = "log10")
```

#### **Conditional plots**

------------------------------------------------------------------------

We can create plots showing the relationship between variables across different values of a factor. For instance, hereâ€™s a scatterplot showing how birth weight varies with hypertension, conditioned on color. Itâ€™s created using the `facet_wrap(~ factor1 + factor2 + ... + factorn)` command.

------------------------------------------------------------------------

```{r}
birthwt.plot <- ggplot(data=birthwt, aes(x=birthwt.grams, y=mother.age))
birthwt.plot + geom_point() + facet_wrap(~ mother.smokes)
```

> As you can see that with using facet_wrap function we added some conditions for our ggplot and while we are using mother.smokes there is 2 conditions and that created 2 ggplots as well

------------------------------------------------------------------------

```{r}
birthwt.plot <- ggplot(data=birthwt, aes(x=birthwt.grams, y=mother.age, colour = mother.smokes))
birthwt.plot + geom_point() + facet_wrap(~ hypertension)
```

------------------------------------------------------------------------

> `ggplot`Â can create a lot of different kinds of plots, just like lattice. Here are some examples.

| Function              | Description                     |
|-----------------------|---------------------------------|
| `geom_point(...)`     | Points, i.e., scatterplot       |
| `geom_bar(...)`       | Bar chart                       |
| `geom_line(...)`      | Line chart                      |
| `geom_boxplot(...)`   | Boxplot                         |
| `geom_violin(...)`    | Violin plot                     |
| `geom_density(...)`   | Density plot with one variable  |
| `geom_density2d(...)` | Density plot with two variables |
| `geom_histogram(...)` | Histogram                       |

#### **A bar chart**

```{r}
qplot(x = race, data = birthwt, geom = "bar")
```

#### **Histograms and density plots**

```{r}
base.plot <- ggplot(birthwt, aes(x = mother.age)) +
  xlab("Mother's age") 
base.plot + geom_histogram()
base.plot + geom_histogram(aes(fill = race), alpha = 0.5)

base.plot <- ggplot(birthwt, aes(x = mother.age)) +
  xlab("Mother's age") 
base.plot + geom_density()
base.plot + geom_density(aes(fill = race), alpha = 0.5)
```

#### **Box plots and violin plots**

```{r}
base.plot <- ggplot(birthwt, aes(x = as.factor(physician.visits), y = birthwt.grams)) +
  xlab("Number of first trimester physician visits") +
  ylab("Baby's birthweight (grams)")

# Box plot
base.plot + geom_boxplot()
```

```{r}
# Violin plot
base.plot + geom_violin()
```

#### **Visualizing means**

> Previously we calculated the following table:

------------------------------------------------------------------------

```{r}
bwt.summary <- aggregate(birthwt.grams ~ race + mother.smokes, data = birthwt, FUN = mean) # aggregate
bwt.summary
```

> We can plot this table in a nice bar chart as follows:

------------------------------------------------------------------------

```{r}
# Define basic aesthetic parameters
p.bwt <- ggplot(data = bwt.summary, aes(y = birthwt.grams, x = race, fill = mother.smokes))

# Pick colors for the bars
bwt.colors <- c("#009E73", "#999999")

# Display barchart
p.bwt + geom_bar(stat = "identity", position = "dodge") +
  ylab("Average birthweight") + 
  xlab("Mother's race") +
  guides(fill = guide_legend(title = "Mother's smoking status")) + 
  scale_fill_manual(values=bwt.colors)
```

#### **Does the association between birthweight and motherâ€™s age depend on smoking status?**

> We previously ran the following command to calculate the correlation between motherâ€™s ages and baby birthweights.

------------------------------------------------------------------------

```{r}
by(data = birthwt[c("birthwt.grams", "mother.age")], 
   INDICES = birthwt["mother.smokes"], 
   FUN = function(x) {cor(x[,1], x[,2])})
```

------------------------------------------------------------------------

> Hereâ€™s a visualization of our data that allows us to see whatâ€™s going on.

------------------------------------------------------------------------

```{r}
ggplot(birthwt, aes(x=mother.age, y=birthwt.grams, shape=mother.smokes, color=mother.smokes)) + 
  geom_point() + # Adds points (scatterplot)
  geom_smooth(method = "lm") + # Adds regression lines
  ylab("Birth Weight (grams)") + # Changes y-axis label
  xlab("Mother's Age (years)") + # Changes x-axis label
  ggtitle("Birth Weight by Mother's Age") # Changes plot title
```
